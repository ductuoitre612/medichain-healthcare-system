<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediChain - H·ªá th·ªëng Y t·∫ø Blockchain</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/frontend/css/landing.css" />

    <!-- Sui Wallet Standard -->
    <script src="https://unpkg.com/@mysten/wallet-standard@latest/dist/index.umd.js"></script>
  </head>
  <body class="login-page">
    <div class="login-container">
      <div class="login-card">
        <!-- Logo -->
        <div class="logo">
          <div class="logo-icon">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
              <path
                d="M12 2L2 7L12 12L22 7L12 2Z"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M2 17L12 22L22 17"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M2 12L12 17L22 12"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
          <h1>MediChain</h1>
          <p class="subtitle">H·ªá th·ªëng Qu·∫£n l√Ω Y t·∫ø Blockchain</p>
        </div>

        <!-- Features -->
        <div class="features">
          <div class="feature">
            <div class="feature-icon blue">üîí</div>
            <div>
              <h3>B·∫£o m·∫≠t cao</h3>
              <p>D·ªØ li·ªáu ƒë∆∞·ª£c m√£ h√≥a tr√™n blockchain</p>
            </div>
          </div>
          <div class="feature">
            <div class="feature-icon green">üìã</div>
            <div>
              <h3>B·ªánh √°n ƒëi·ªán t·ª≠</h3>
              <p>Qu·∫£n l√Ω v√† chia s·∫ª d·ªÖ d√†ng</p>
            </div>
          </div>
          <div class="feature">
            <div class="feature-icon purple">üíä</div>
            <div>
              <h3>ƒê∆°n thu·ªëc s·ªë</h3>
              <p>Kh√¥ng th·ªÉ gi·∫£ m·∫°o, an to√†n tuy·ªát ƒë·ªëi</p>
            </div>
          </div>
        </div>

        <!-- Connect Wallet Button -->
        <button id="connectWalletBtn" class="btn-primary btn-large">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M21 18V19C21 20.1 20.1 21 19 21H5C3.89 21 3 20.1 3 19V5C3 3.9 3.89 3 5 3H19C20.1 3 21 3.9 21 5V6H12C10.89 6 10 6.9 10 8V16C10 17.1 10.89 18 12 18H21ZM12 16H22V8H12V16ZM16 13.5C15.17 13.5 14.5 12.83 14.5 12C14.5 11.17 15.17 10.5 16 10.5C16.83 10.5 17.5 11.17 17.5 12C17.5 12.83 16.83 13.5 16 13.5Z"
              fill="currentColor"
            />
          </svg>
          K·∫øt n·ªëi Sui Wallet
        </button>

        <p class="help-text">
          Ch∆∞a c√≥ Sui Wallet?
          <a
            href="https://chromewebstore.google.com/detail/sui-wallet/opcgpfmipidbgpenhmajoajpbobppdil"
            target="_blank"
          >
            T·∫£i v·ªÅ t·∫°i ƒë√¢y
          </a>
        </p>
      </div>

      <!-- Network Info -->
      <div class="network-info">
        <span class="network-badge">Testnet</span>
        <span class="network-status">
          <span class="status-dot"></span>
          ƒê√£ k·∫øt n·ªëi
        </span>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="spinner"></div>
      <p>ƒêang k·∫øt n·ªëi v√≠...</p>
    </div>

    <!-- Error Notification -->
    <div
      id="errorNotification"
      style="
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff4757;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 10000;
      "
    >
      <span id="errorMessage"></span>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/wallet.js"></script>
    <script>
      // Show error notification
      function showErrorNotification(message) {
        const notification = document.getElementById("errorNotification");
        const messageEl = document.getElementById("errorMessage");
        messageEl.textContent = message;
        notification.style.display = "block";

        setTimeout(() => {
          notification.style.display = "none";
        }, 5000);
      }

      // Connect Wallet Button
      document
        .getElementById("connectWalletBtn")
        .addEventListener("click", async () => {
          const overlay = document.getElementById("loadingOverlay");
          overlay.style.display = "flex";

          try {
            // Check if wallet is installed
            if (typeof window.suiWallet === "undefined") {
              throw new Error("Vui l√≤ng c√†i ƒë·∫∑t Sui Wallet extension tr∆∞·ªõc");
            }

            // Connect wallet
            const connected = await connectWallet();

            if (connected) {
              // Save to localStorage
              const accounts = await window.suiWallet.getAccounts();
              if (accounts && accounts.length > 0) {
                localStorage.setItem("medichain_wallet", accounts[0]);

                // Redirect to dashboard
                setTimeout(() => {
                  window.location.href = "dashboard.html";
                }, 500);
              } else {
                throw new Error("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n v√≠");
              }
            } else {
              throw new Error("K·∫øt n·ªëi v√≠ th·∫•t b·∫°i");
            }
          } catch (error) {
            console.error("L·ªói k·∫øt n·ªëi:", error);
            showErrorNotification(
              error.message || "Kh√¥ng th·ªÉ k·∫øt n·ªëi v√≠. Vui l√≤ng th·ª≠ l·∫°i."
            );
          } finally {
            overlay.style.display = "none";
          }
        });

      // Check if already connected
      window.addEventListener("load", async () => {
        const wallet = localStorage.getItem("medichain_wallet");
        if (wallet) {
          // Verify wallet is still connected
          try {
            if (typeof window.suiWallet !== "undefined") {
              const accounts = await window.suiWallet.getAccounts();
              if (accounts && accounts.length > 0) {
                // Still connected, redirect to dashboard
                window.location.href = "dashboard.html";
                return;
              }
            }
            // Not connected anymore, clear storage
            localStorage.removeItem("medichain_wallet");
          } catch (error) {
            console.error("Error checking wallet:", error);
            localStorage.removeItem("medichain_wallet");
          }
        }
      });
    </script>
  </body>
</html>
